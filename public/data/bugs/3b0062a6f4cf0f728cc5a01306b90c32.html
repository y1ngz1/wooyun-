<!doctype html>
                        <html lang="en">
                        <head>
	                        <meta charset="UTF-8">
	                        <title>		中国电信某GPS监控平台存在严重问题！  </title>
	                        <link href="../css/css.css" rel="stylesheet" /> 
                        </head>
                        <body> 
                        <ul><li>标题：		中国电信某GPS监控平台存在严重问题！  </li><li>作者：		<a href="http://www.wooyun.org/whitehats/zeracker">zeracker</a> 
</li><li>提交时间：		2012-05-14 10:47</li></ul>
                        <div class="con">
                        <h2>漏洞详情</h2>
		<h3 class="detailTitle">披露状态：</h3>
		<p class="detail" style="padding-bottom:0">
					</p>
		<p class="detail">
									2012-05-14：	细节已通知厂商并且等待厂商处理中<br/>
									2012-05-14：	厂商已经确认，细节仅向厂商公开<br/>
									2012-05-24：	细节向核心白帽子及相关领域专家公开<br/>
									2012-06-03：	细节向普通白帽子公开<br/>
									2012-06-13：	细节向实习白帽子公开<br/>
									2012-06-28：	细节向公众公开<br/>
					</p>
		<h3 class="detailTitle">简要描述：</h3>

		<p class="detail">  <br />
  第一次接触这个高科技东西，哈哈。。<br />
<br />
  看到国字开头的运营商就头大（监控后台显示的中国电信），GPS监控系统平台。在应用上我就不多说了，因为这个还是有一定权限的。<br />
<br />
在应用上来讲的话，我大致看了下（一眼就能记住，当然也能马上忘记不该看的东西）以下四点基本貌似都存在相应的，至少在公检法倒是有不少的。我就不吐槽了，因为在乌云第一次发这样的东西，刚接触2天工控上的，感觉特恐怖，因为不能像平时一样进行测试，也罢，顺带普及下知识，具体看详细说明及配图吧。<br />
<br />
   有警车哈？O(∩_∩)O哈哈~<br />
<br />
类似的安全隐患还是非常多的。希望各位白帽子们都能够重视起来！<br />
<br />
当然有关部门需要高度重视，希望能够继续提供案例，加强工业控制系统信息安全。<br />
<br />
</p>

				
						<h3 class="detailTitle">详细说明：</h3>
		
			<p class="detail">  第一次接触这个高科技东西，哈哈。。<br />
<br />
<br />
<br />
  看到国字开头的运营商就头大（监控后台显示的中国电信）GPS监控系统平台。<br />
<br />
  <br />
<br />
   </p><p class="detail"><a href="../images/14034359bc37a6f5137f29e75fade1866bbba30a.jpg" target="_blank"><img src="../images/14034359bc37a6f5137f29e75fade1866bbba30a.jpg" alt="" width="600"/></a></p><p class="detail">  <br />
<br />
<br />
<br />
   在应用上我就不多说了，因为这个还是有一定权限的。<br />
<br />
<br />
<br />
   </p><p class="detail"><a href="../images/140345116bd32e2a409e67dc8e7b84e3f8144f7f.jpg" target="_blank"><img src="../images/140345116bd32e2a409e67dc8e7b84e3f8144f7f.jpg" alt="" width="600"/></a></p><p class="detail">  <br />
<br />
<br />
<br />
   <br />
<br />
 <br />
<br />
  </p><p class="detail"><a href="../images/14035137324215d1d86ae4f49823e7bb4360472d.jpg" target="_blank"><img src="../images/14035137324215d1d86ae4f49823e7bb4360472d.jpg" alt="" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
在应用上来讲的话，我大致看了下（一眼就能记住，当然也能马上忘记不该看的东西）以下四点基本貌似都存在相应的，至少在公检法倒是有不少的。<br />
<br />
   <br />
<br />
我就不吐槽了，因为在乌云第一次发这样的东西，刚接触2天工控上的，感觉特恐怖，因为不能像平时一样进行测试，也罢，顺带普及下知识，具体看详细说明及配图吧。<br />
<br />
</p><p class="detail"><a href="../images/140345540bd9c5d30d7fcfec49efc010962b91c8.jpg" target="_blank"><img src="../images/140345540bd9c5d30d7fcfec49efc010962b91c8.jpg" alt="" width="600"/></a></p><p class="detail"> <br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
(1)运输车队遥控指挥系统 <br />
<br />
 <br />
<br />
以车辆监控系统为核心，组成货物运输车队的遥控指挥系统，中心站根据每辆车的实时位置与货物的起讫点对车辆的行驶路径进行综合规划，从而提高车辆利用率，降低成本，最大限度地减少在路上的时间，提高道路利用率； <br />
<br />
 <br />
<br />
(2)最佳运行路线的调整 <br />
<br />
 <br />
<br />
以车辆监控系统为核心，进行适当地改造，实时地半道路堵塞情况通知给移动车辆，使系统内的用户能够及时调整最佳运行路线，为城市内各条道路的交通流量实现自动调节，从而达到提高道路通行能力的目的。 <br />
<br />
 <br />
<br />
(3)特种车辆实时跟踪 <br />
<br />
 <br />
<br />
特种车辆如救护车、安全巡逻车、消防车等利用路径导航系统能以最快的速度到达事故地点，减少因事故造成的损失。另一方面，管理中心实时跟踪这些特种车辆，可以随时调度，及时清除事故引起的路障，保证道路交通的畅通。 <br />
<br />
 <br />
<br />
(4)公交车辆的调度与管理 <br />
<br />
</p><p class="detail"><a href="../images/14034634489494988722e78684d6c913e6eeacb2.jpg" target="_blank"><img src="../images/14034634489494988722e78684d6c913e6eeacb2.jpg" alt="" width="600"/></a></p><p class="detail"> <br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
 GPS是美国国防部研制的星基无线电导航系统，除了军事上的应用外，该系统在民用领域中的应用也非常广泛，其中车辆监控系统和导航仪便是两个典型的应用实例。车辆监控系统是将GPS、GIS和现代通信技术综合在一起的高科技系统，通过无线数据传输，移动车辆的定位信息及状态信息可以实时地传送到监控中心，从而实现对车辆的移动管理及安全监视。而导航仪的基本含义是利用GPS接收机对移动载体进行定位，提供给驾驶员当前的位置信息，从而可以对载体的运行路线加以引导。导航仪所利用的技术主要是GPS定位以及GIS技术，其数学基础还涉及到图论、优化理论等。总之，两个系统均为GPS应用领域中的典型系统。下面对这两种系统分别加以介绍。<br />
<br />
一、GPS车辆监控系统 <br />
<br />
 <br />
<br />
1.车辆监控系统的拓扑结构及其子系统划分 <br />
<br />
 <br />
<br />
　　GPS车辆监控系统的拓扑结构如图1所示，各移动车辆的组成与功能均相同，监控中心兼有地理信息显示部分，提供信息查询和可视化监控。中心和移动车辆都具有基本相同的通信控制器，形成系统工作的时序逻辑及数据结构。按照功能划分系统主要有三部分：定位子系统、通信子系统和监控子系统，图2为功能划分组成简图。 <br />
<br />
<br />
<br />
</p><p class="detail"><a href="../images/1403470855d393f553856b173f87fb9c450ae98c.jpg" target="_blank"><img src="../images/1403470855d393f553856b173f87fb9c450ae98c.jpg" alt="" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
2.系统工作原理 <br />
<br />
 <br />
<br />
无线通信是GPS车辆监控系统正常工作的基础，通信子系统在中心站和各子站之间提供传输信息的必要条件。各子站配备的GPS接收机用以获取自己当前的位置、时间等信息，经差分修正后通过通信链路定时向中心站发送状态和位置等信息；在中心站，系统配备的GPS接收机(基准GPS接收机)用以求解关于一定区域的差分修正信息并在指定时间发送给子站，无线接收机定时接收各子系统的位置信息，并通过通信控制器送往电子地图，显示各子站的运动轨迹。系统由监控软件实现对各子站的状态监控，并可利用无线通信对各子站进行调度指挥。这样就实现了对各子站的监控管理。在监控中心可以采取两种工作方式：主动查询方式和被动显示车辆信息方式，在查询方式下，子站只在查询时发送自身的数据；被动显示方式下，中心站定时接收各子站的位置及状态等相关信息。下面从各个子系统的角度介绍车辆监控系统的构成及其相关问题。 <br />
<br />
 <br />
<br />
3.定位子系统 <br />
<br />
 <br />
<br />
(1)差分GPS <br />
<br />
 <br />
<br />
GPS差分的基本原理是利用监控中心的精确坐标与卫星实测信号进行求差获得差分信息，而后修正移动目标的定位坐标。根据差分修正信息的不同和修正在中心站完成还是在移动站完成，可以得到四种不同的差分修正方式： <br />
<br />
 <br />
<br />
方法1 前向差分，伪距信息：中心站发送伪距修正信息，移动站修正。 <br />
<br />
 <br />
<br />
方法2 前向差分，位置信息：中心站发送位置修正信息，移动站修正。 <br />
<br />
 <br />
<br />
方法3 后向差分，伪距信息：中心站根据伪距差分信息修正移动站GPS数据。 <br />
<br />
 <br />
<br />
方法4 后向差分，位置信息：中心站根据位置差分信息修正移动站GPS数据。 <br />
<br />
 <br />
<br />
四种差分方法中，方法1和方法2可为GPS用户接收机提供经差分修正的位置数据，这对任何需要精确导航的应用来说都是基本的方法。当需要为很多用户服务时，方法1是比较好的，中心站不需非要知道用户定位所使用的卫星，因为发送的是视野内所有卫星的修正值。方法3和方法4是对上行传输的GPS数据进行严格的数据处理，但是需要各子站发送的数据量较大，影响系统的容量。 <br />
<br />
 <br />
<br />
(2)辅助定位方式 <br />
<br />
 <br />
<br />
对于GPS系统，在城市高楼区、林荫道、涵洞等，常出现GPS卫星信号遮挡问题，导致GPS的功能失效，不能正常定位。此时就应有相应的补救措施，使车辆仍能定位。另一方面，车辆的定位数据和电子地图中的道路是否吻合，也决定了监控系统的精度。因此，在监控系统中的定位由以下三部分组成：GPS、航迹推算、地图匹配。其中航迹推算是一种经典的车辆定位技术，基本原理是利用方向和距离传感器来推算车辆位置，该推算过程是一个累加过程，由于这种累加过程会把每一时刻方向和距离传感器的误差累加起来，导致推算系统的定位误差随时间的推移越来越大，因此，航位推算方法不能单独、长时间地使用；地图匹配指根据车辆行驶的道路以及电子地图的信息对传感器融合得到的定位数据进行滤波，从而获得车辆在地图中的准确位置，实现车辆轨迹与地图的最佳吻合。即整个定位过程是GPS和航位推算的数据通过数据融合算法结合起来，再经过地图匹配，最后形成精确的定位解。图3示出了一种获得定位解的结构简图。 <br />
<br />
 <br />
<br />
(3)传感器数据融合 <br />
<br />
 <br />
<br />
从上述分析可以看出，单个定位方法对提供高精度的位置数据都有不同程度的缺陷，因 <br />
<br />
 <br />
<br />
此，多传感器数据融合对高精度的车辆监控系统而言就是必需的。数据融合就是充分利用各种传感器信息，应用高通、低通、卡尔曼滤波等各种滤波手段，将多个传感器引进的误差或同一传感器引进的不同频谱范围的误差分别加以消除，而后获得高精度的数据输出。 <br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
4.监控子系统 <br />
<br />
 <br />
<br />
监控子系统主要是由基于电子地图的监控软件构成，该监控软件也是一个具有信息查询功能的信息管理系统。其中电子地图的直观显示可以方便车辆调度与安全方面的管理和指挥，对安全报警和及时救护提供可视化依据。监控中心的工作人员可通过中心操作台上的电子地图监控所有入网的移动目标，一旦移动目标发出报警，监控中心的工作人员会得到提示(声音或光信号)，有关报警目标的信息情况也会立即在计算机屏幕上显示出来，如该车辆位置、状态或者附的保安部门等。工作人员由此可以监视目标，并迅速调动警力赶往中发现声采取相应措施。因此信息管理与查询功能在车辆监控系统中的作用非常重要，它提供的动态信息管理功能是监控系统发挥其作用的关键要素。 <br />
<br />
 <br />
<br />
(1)电子地图 <br />
<br />
 <br />
<br />
按数据结构和显示过程，电子地图可以划分为两种：一是像电子地图，即利用扫描仪对原始地图进行扫描，而后作为数字图像或栅格编码结构存储在计算机内，可为用户提供所有的原始地图具有的信息，且与纸质地图极为相似；二矢量电子地图，即将地图转换成矢量编码结构，占用较少的计算机空间，并可以快速地存取与访问，且具有更大的灵活性，易于操作。对栅格编码的数字化地图而言，所有信息均针对每一个像素单元，占用的存储空间大，在车辆监控系统以及导航系统中都很难使用。对矢量编码的地图，用户可以很方便地进行编辑，形成有用的一个或几个文件，根据需要随时调用。如只关心某区域的道路网，则可生成一个只有道路信息的文件，进行快速查询有关信息。 <br />
<br />
 <br />
<br />
在车辆监控系统中，一般使用矢量化电子地图。移动车辆的定位数据要在地图中，因此必须考虑地图和定位数据所使用的坐标系统。定位数据一般以GPS为主，得到的是WGS–84地心大地坐标系下的经度、纬度与高度，而目前我国使用的地图多为北京54坐标系，故而需要进行相应地坐标转换。 <br />
<br />
 <br />
<br />
如果地图坐标为WGS–84，则不必进行上述转换。 <br />
<br />
 <br />
<br />
空间信息查询是根据用户给定的一种或多种条件从地图数据库中提取满足这些条件的空间对象或对象集合的过程。根据检索条件的性质，查询分为两大类：常规查询和拓扑查询。车辆导航路径选取计算就是拓扑查询的一种，它是基于面向弧线结构图形文件中的节点一弧线关系，应用图论理论设计完成的。 <br />
<br />
 <br />
<br />
①常规查询 <br />
<br />
 <br />
<br />
根据物体的特征可以进行常规查询。按特征种类又可分为：定性查询和定位查询。 <br />
<br />
 <br />
<br />
②拓扑查询 <br />
<br />
 <br />
<br />
拓扑查询是根据空间对象间的拓扑关系进行查询。它的含义是：给出地图中的一个元素，如一个节点或一段弧线，要求选出地图中的一批元素，它们在拓扑意义下与给定元素邻接或关联为包含关系。 <br />
<br />
 <br />
<br />
按照在数据结构中表示的拓扑关系是显式还是隐式，拓扑查询可分为两类：直接拓扑查询、间接拓扑查询。 <br />
<br />
 <br />
<br />
5.通信子系统 <br />
<br />
 <br />
<br />
由于车辆监控系统的特殊性，被监控对象和监控中心的通信必须利用无线通信。一般说来，构建新的车辆监控系统要充分利用现有的具有数据传输功能的通信系统，以降低成本，或根据不具备数据传输功能的通信系统如模拟蜂窝系统的特点，从系统底层结构出发，对系统进行一定的改造，开发接口与控制电路，使之能够用以传检数据。车辆监控系统可以利用的通信方式有：①固定频率通信方式；②集群移动通信方式；③蜂窝移动通信方式；④蜂窝数安分组数据(CDPD0；⑤卫星通信。 <br />
<br />
 <br />
<br />
(1)固定频率通信方式 <br />
<br />
 <br />
<br />
最简单的车辆监控系统使用单一频率进行通信，不同的被监控车辆由时隙来区分，因此可以称之为TDMA(时分多址)方式。受控车辆在不同的时隙内传输GPS数据到监控中心，中心站将各个受控车辆的数据统一接收显示。同时利用该对频率进行通话，实现简单的调度指挥。系统中使用的无线电台可以是双工或半双工电台。用该种方法组建的车辆监控系统具有容量小，覆盖范围小等缺点，但是对容量不大的系统来说还是较为实用的。 <br />
<br />
 <br />
<br />
(2)集群移动通信方式 <br />
<br />
 <br />
<br />
集群通信系统是专用调度通信系统，其特点是“频率共用”，即系统内用户共同使用一组频率，用户每次建立通话前首先向调度台提出申请，调度台将搜索到的空闲信道分配给该用户。集群通信为用户提供的基本业务有话音通信、保密话音通信、数据及状态信息传输，并具有多种呼叫接续方式，如移动台到移动台、移动台到调度台双向、有线接续等，呼叫类型有单呼、组呼、全呼、有无线互连呼叫。因此，利用集群通信的多种工作方式可以组建灵活的车辆监控系统。 <br />
<br />
 <br />
<br />
(3)蜂窝移动通信方式 <br />
<br />
 <br />
<br />
上述介绍的两种方法分别属于频率单用和频率共用，而蜂窝移动通信的核心概念是频率复用。即多个用户共用一组频率，同时多组用户在不同的地方仍使用该组频率进行通信，从而大大地提高了频率的利用率，其中区域之间的距离与区域的半径之比随划分的区域数量不同而不同。 <br />
<br />
 <br />
<br />
目前蜂窝移动通信已经从第一代频分多址(FDMA)方式的模拟体制，历经第二代时分多址(TDMA)数字体制发展到第三代码分多址(CDMA)数字体制。 <br />
<br />
 <br />
<br />
尽管CDMA体制的容量比TDMA大，但是目前在我国其通信网的建立还处在实验阶段，用户也非常有限，因此使用最为广泛的蜂窝式为以TDMA体制为核心的GSM(Global System of Mobile Telecommunication)网。GSM字蜂窝移动通信系统(简称GSM系统)是完全依据欧洲通信标准化委员会(ETSI)制定的GSM技术规范研制而成的，它所提供的业务主要有：电信业务和承载业务。电信业务又包括话音通信与短消息业务等，由于短消息业务经济实惠，故而可以用于车辆监控系统的数据传输。 <br />
<br />
 <br />
<br />
(4)蜂窝数字式分组数据系统蜂窝数字式分组数据系统(CDPD)，使用蜂窝系统的空闲话音信道传送业务，也可以指定一个专用信道传送数据业务。美国ITS联合会已经将CDPD系统确定为提供道路交通信息及为驾驶员进行路径导航的通信网络。 <br />
<br />
 <br />
<br />
(5)卫星通信方式 <br />
<br />
 <br />
<br />
卫星通信是利用通信卫星提供转发功能，实现远距离、覆盖面广的通信。目前，Inmarsat–D+地面站已经建立，组建大范围的车辆监控系统可以选用该系统。InmarsatD+是第一个全球双向卫星短信息传输系统，可以使用户在全球的任何地方与固定终端进行双向短信息通信，也可传送GPS的定位信息，这可弥补GSM通信方式覆盖面受限制的不足。该系统由四部分组成：①Inmarsat卫星；②卫星地面接收站(LES)；③用户指挥中心(UCO)；④远程终端或移动终端(MES)。 <br />
<br />
 <br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
7.车辆监控系统在智能交通系统中的应用 <br />
<br />
 <br />
<br />
智能交通系统(ITS)的基本含义是利用现代高新技术对已有的交通设施进行改进，辅之以车辆自动识别系统、电子收费系统、车辆管理系统、交通控制系统、公交车辆智能调度指挥系统等，以提高道路的利用率，减少车辆行驶时间，增加车辆和人员的安全性，节省能源，改善环境。概括说来，在ITS整个系统中，车辆监控系统具有以下几个作用： <br />
<br />
 <br />
<br />
(1)运输车队遥控指挥系统 <br />
<br />
 <br />
<br />
以车辆监控系统为核心，组成货物运输车队的遥控指挥系统，中心站根据每辆车的实时位置与货物的起讫点对车辆的行驶路径进行综合规划，从而提高车辆利用率，降低成本，最大限度地减少在路上的时间，提高道路利用率； <br />
<br />
 <br />
<br />
(2)最佳运行路线的调整 <br />
<br />
 <br />
<br />
以车辆监控系统为核心，进行适当地改造，实时地半道路堵塞情况通知给移动车辆，使系统内的用户能够及时调整最佳运行路线，为城市内各条道路的交通流量实现自动调节，从而达到提高道路通行能力的目的。 <br />
<br />
 <br />
<br />
(3)特种车辆实时跟踪 <br />
<br />
 <br />
<br />
特种车辆如救护车、安全巡逻车、消防车等利用路径导航系统能以最快的速度到达事故地点，减少因事故造成的损失。另一方面，管理中心实时跟踪这些特种车辆，可以随时调度，及时清除事故引起的路障，保证道路交通的畅通。 <br />
<br />
 <br />
<br />
(4)公交车辆的调度与管理 <br />
<br />
 <br />
<br />
城市规模的日益扩大以及公共交通的巨大发展，一方面使得客流量增大、车辆增加、车次增多、线路延长；另一方面导致交通拥挤、行车速度下降、行车间隔不均匀，时常出现串车和大间隔的现象，增大了调度工作的难度。尤其是调度人员无法实时了解道路交通状况，难以及时采取有效的调度措施。利用GPS车辆监控系统作为公交车辆的调度管理，使传送到调度中心的状态信息(包含路状和乘客的信息)，改善公交车辆的运营效率，摆脱公交调度盲目性的滞后性的落后现状。 <br />
<br />
 </p>
				
									<h3 class="detailTitle">漏洞证明：</h3>

			<p class="detail"></p><p class="detail"><a href="../images/14035107e6373f1ce23d9974f7ef986c7ec02d92.jpg" target="_blank"><img src="../images/14035107e6373f1ce23d9974f7ef986c7ec02d92.jpg" alt="" width="600"/></a></p><p class="detail"></p><p class="detail"><a href="../images/14034828cc23dadd4592eff4645e5d3a5bc92b5b.jpg" target="_blank"><img src="../images/14034828cc23dadd4592eff4645e5d3a5bc92b5b.jpg" alt="" width="600"/></a></p><p class="detail"><br />
<br />
<br />
<br />
<br />
<br />
 </p>

									<h3 class="detailTitle">修复方案：</h3>
			<p class="detail">类似的安全隐患还是非常多的。希望各位白帽子们都能够重视起来！<br />
<br />
<br />
<br />
当然有关部门需要高度重视，希望能够继续提供案例，加强工业控制系统信息安全。 </p>
										<h3 class="detailTitle">版权声明：转载请注明来源 <a style="font-weight:normal" href="http://www.wooyun.org/whitehats/zeracker" title="zeracker">zeracker</a>@<a style="font-weight:normal" href="http://www.wooyun.org/bugs/wooyun-2010-07084" title="中国电信某GPS监控平台存在严重问题！">乌云</a></h3>
		<hr align="center"/>

				
			<h2>漏洞回应</h2>
			
			
															<h3 class="detailTitle">厂商回应：</h3>
						<p class="detail">危害等级：中</p>
						<p class="detail">漏洞Rank：8 </p>
													<p class="detail">确认时间：2012-05-14 15:47</p>
												<h3 class="detailTitle">厂商回复：</h3>				
						<p class="detail">CNVD确认漏洞并复现所述情况，协调中国电信集团公司处置，同时作为报告附件之一上报国务院某信息安全协调机构。<br />
<br />
rank 8。</p>
					

					
					
					<h3 class="detailTitle">最新状态：</h3>

											<p class="detail">暂无</p>
					

							
					
		
<hr align="center" />
<script type="text/javascript">
var bugid="7084";
var bugRating="-3";
var myRating="";
var ratingCount="0";



function ShowBugRating(k){
	var ratingItems=$(".myrating span");
	$.each(ratingItems,function(i,n){
		var nk=parseInt($(n).attr("rel"));
		if(nk<=k){
			$(n).addClass("on");
		}else{
			$(n).removeClass("on");
		}
	});
	$(".myrating span").hover(
		function(){
			$("#ratingShow").html($(this).attr("data-title"));
		},
		function(){
			$("#ratingShow").html("");
		}
	);
}
$(document).ready(function(){
	if(myRating==""){
		var ratingItems=$(".myrating span");
		$(".myrating span").hover(
			function(){
				$(this).addClass("hover");
				var k=parseInt($(this).attr("rel"));
				$.each(ratingItems,function(i,n){
					var nk=parseInt($(n).attr("rel"));
					if(nk<k) $(n).addClass("on");
					if(nk>k) $(n).removeClass("on");
				});
				$("#ratingShow").html($(this).attr("data-title"));
			},
			function(){
				$(this).removeClass("hover");
				if($("#myRating").val()==""){
					$.each(ratingItems,function(i,n){
						$(n).removeClass("on");
					});
				}
				$("#ratingShow").html("");
			}
		);

		$(".myrating span").click(function(){
			var rating=$(this).attr("rel");
			var k=parseInt($(this).attr("rel"));
			$.post("/ajaxdo.php?module=bugrating",{"id":bugid,"rating":rating,"token":$("#token").val()},function(re){
				//消除操作绑定
				$(".myrating span").unbind();
				re=parseInt(re);
				switch(re){
					case 1:
						$("#ratingShow").html("评分成功");
						$("#ratingSpan").html(parseInt($("#ratingSpan").html())+1);
						$.each(ratingItems,function(i,n){
							var nk=parseInt($(n).attr("rel"));
							if(nk<=k){
								$(n).addClass("on");
							}else{
								$(n).removeClass("on");
							}
						});
						ShowBugRating(rating);
						break;
					case 2:
						$("#ratingShow").html("请先登录");
						break;
					case 4:
						$("#ratingShow").html("已对此漏洞进行过评分");
						break;
					case 6:
						$("#ratingShow").html("不能对自己发布的漏洞进行评分");
						break;
					default:break;
				}
			});
		});
	}else{
		if(ratingCount>2){
			ShowBugRating(bugRating);
		}else{
			ShowBugRating(-3);
		}
	}
});

</script>
<h3 class="detailTitle">漏洞评价：</h3>
                        </div>
                        </body>
                        </html>
